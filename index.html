<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Lavoro Online</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
        }
        
        .login-section, .main-section {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        h1, h2 {
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .btn-danger {
            background-color: #e74c3c;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: #2ecc71;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: #f39c12;
        }
        
        .btn-warning:hover {
            background-color: #d35400;
        }
        
        .work-day {
            background-color: #f9f9f9;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            position: relative;
        }
        
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .work-day h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            padding-right: 60px;
        }
        
        .work-day p {
            margin-bottom: 5px;
        }
        
        .total-section {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .logout-btn {
            background-color: #7f8c8d;
            float: right;
        }
        
        .logout-btn:hover {
            background-color: #636e72;
        }
        
        .alert {
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .alert-error {
            background-color: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }
        
        .alert-success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }
        
        .alert-info {
            background-color: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #1565c0;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .setup-section {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>📊 Registro Lavoro Online</h1>
            <p>I tuoi dati sincronizzati su tutti i dispositivi</p>
        </header>
        
        <!-- Sezione configurazione -->
        <section id="setupSection" class="setup-section">
            <h2>🔧 Configurazione Google Sheets</h2>
            <p>Per usare questa app, devi creare un Google Sheet e inserire qui il suo ID:</p>
            <div class="form-group">
                <label for="sheetId">ID del tuo Google Sheet:</label>
                <input type="text" id="sheetId" placeholder="Incolla qui l'ID del tuo Sheet">
            </div>
            <button id="saveConfigBtn" class="btn-success">Salva Configurazione</button>
            <div id="configAlert" class="alert alert-info hidden">
                <p><strong>Come trovare l'ID del Sheet:</strong></p>
                <ol>
                    <li>Crea un nuovo Google Sheet</li>
                    <li>Copia l'URL (es: https://docs.google.com/spreadsheets/d/1AbC2dEfGhIjKlMnOpQrStUvWxYz/edit)</li>
                    <li>Incolla l'URL e prendi la parte tra "/d/" e "/edit"</li>
                </ol>
            </div>
        </section>
        
        <!-- Sezione principale -->
        <section id="mainSection" class="main-section">
            <button id="logoutBtn" class="logout-btn">Logout</button>
            <h2>👋 Benvenuto!</h2>
            
            <!-- Form per aggiungere un giorno di lavoro -->
            <div class="form-group">
                <h3>➕ Aggiungi Giorno di Lavoro</h3>
                <label for="workDate">Data:</label>
                <input type="date" id="workDate">
                
                <label for="dailyPay">Paga Giornaliera (€):</label>
                <input type="number" id="dailyPay" placeholder="Inserisci la paga giornaliera" min="0" step="0.01">
                
                <label for="workNotes">Note sul lavoro svolto:</label>
                <textarea id="workNotes" placeholder="Descrivi cosa hai fatto oggi..."></textarea>
                
                <button id="addWorkDayBtn" class="btn-success">Aggiungi Giorno</button>
                <div id="addAlert" class="alert alert-success hidden">Giorno di lavoro aggiunto con successo!</div>
            </div>
            
            <!-- Pulsanti di sincronizzazione -->
            <div class="form-group">
                <h3>🔄 Sincronizzazione</h3>
                <button id="loadDataBtn" class="btn-warning">Carica Dati dal Web</button>
                <button id="syncDataBtn" class="btn-success">Salva Dati Online</button>
                <div id="syncAlert" class="alert alert-info hidden"></div>
            </div>
            
            <!-- Elenco dei giorni di lavoro -->
            <div class="work-days-list">
                <h3>📅 Storico Giorni di Lavoro</h3>
                <div id="loadingIndicator" class="loading hidden">
                    <div class="spinner"></div>
                    <p>Caricamento dati...</p>
                </div>
                <div id="workDaysList"></div>
                
                <!-- Riepilogo totale -->
                <div id="totalSection" class="total-section hidden">
                    <h3>💰 Riepilogo</h3>
                    <p>Totale giorni lavorati: <span id="totalDays">0</span></p>
                    <p>Guadagno totale: €<span id="totalEarnings">0.00</span></p>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Elementi DOM
        const setupSection = document.getElementById('setupSection');
        const mainSection = document.getElementById('mainSection');
        const sheetIdInput = document.getElementById('sheetId');
        const saveConfigBtn = document.getElementById('saveConfigBtn');
        const configAlert = document.getElementById('configAlert');
        const logoutBtn = document.getElementById('logoutBtn');
        const workDate = document.getElementById('workDate');
        const dailyPay = document.getElementById('dailyPay');
        const workNotes = document.getElementById('workNotes');
        const addWorkDayBtn = document.getElementById('addWorkDayBtn');
        const addAlert = document.getElementById('addAlert');
        const loadDataBtn = document.getElementById('loadDataBtn');
        const syncDataBtn = document.getElementById('syncDataBtn');
        const syncAlert = document.getElementById('syncAlert');
        const workDaysList = document.getElementById('workDaysList');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const totalSection = document.getElementById('totalSection');
        const totalDays = document.getElementById('totalDays');
        const totalEarnings = document.getElementById('totalEarnings');

        // Configurazione
       const SCRIPT_URL = 'https://cors-anywhere.herokuapp.com/https://script.google.com/macros/s/AKfycbxK5rFjgZvNgEpRHoD2hjJ81BgD88xbTHjzfLoN2MDn_vk8u50e_UrLAiY2ixnobjP2kQ/exec'; // Sostituisci con il tuo URL
        
        // Imposta la data di oggi come predefinita
        const today = new Date().toISOString().split('T')[0];
        workDate.value = today;

        // Carica la configurazione salvata
        let currentSheetId = localStorage.getItem('googleSheetId');
        if (currentSheetId) {
            sheetIdInput.value = currentSheetId;
            setupSection.classList.add('hidden');
            mainSection.classList.remove('hidden');
            loadDataFromWeb();
        }

        // Salva configurazione
        saveConfigBtn.addEventListener('click', function() {
            const sheetId = sheetIdInput.value.trim();
            if (!sheetId) {
                alert('Inserisci un ID Sheet valido');
                return;
            }
            
            localStorage.setItem('googleSheetId', sheetId);
            currentSheetId = sheetId;
            
            setupSection.classList.add('hidden');
            mainSection.classList.remove('hidden');
            loadDataFromWeb();
        });

        // Mostra aiuto configurazione
        sheetIdInput.addEventListener('focus', function() {
            configAlert.classList.remove('hidden');
        });

        // Aggiungi giorno di lavoro
        addWorkDayBtn.addEventListener('click', function() {
            const date = workDate.value;
            const pay = parseFloat(dailyPay.value);
            const notes = workNotes.value.trim();
            
            if (!date || isNaN(pay) || pay <= 0) {
                alert('Per favore, inserisci una data valida e una paga maggiore di 0.');
                return;
            }
            
            const workDay = {
                id: Date.now(),
                date: date,
                pay: pay,
                notes: notes
            };
            
            saveWorkDayLocal(workDay);
            
            addAlert.classList.remove('hidden');
            setTimeout(() => {
                addAlert.classList.add('hidden');
            }, 3000);
            
            dailyPay.value = '';
            workNotes.value = '';
            
            loadUserData();
        });

        // Sincronizza dati online
        syncDataBtn.addEventListener('click', async function() {
            if (!currentSheetId) {
                alert('Configura prima il Google Sheet');
                return;
            }
            
            const userData = JSON.parse(localStorage.getItem('workData')) || [];
            
            try {
                syncAlert.textContent = 'Salvataggio dati online...';
                syncAlert.classList.remove('hidden');
                syncAlert.className = 'alert alert-info';
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'SAVE',
                        sheetId: currentSheetId,
                        data: userData
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    syncAlert.textContent = '✅ Dati salvati online con successo!';
                    syncAlert.className = 'alert alert-success';
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                syncAlert.textContent = '❌ Errore nel salvataggio: ' + error.message;
                syncAlert.className = 'alert alert-error';
            }
        });

        // Carica dati dal web
        loadDataBtn.addEventListener('click', function() {
            loadDataFromWeb();
        });

        // Logout
        logoutBtn.addEventListener('click', function() {
            localStorage.removeItem('googleSheetId');
            localStorage.removeItem('workData');
            mainSection.classList.add('hidden');
            setupSection.classList.remove('hidden');
            sheetIdInput.value = '';
        });

        // Funzioni
        function saveWorkDayLocal(workDay) {
            const userData = JSON.parse(localStorage.getItem('workData')) || [];
            userData.push(workDay);
            localStorage.setItem('workData', JSON.stringify(userData));
        }

        async function loadDataFromWeb() {
            if (!currentSheetId) return;
            
            try {
                loadingIndicator.classList.remove('hidden');
                workDaysList.innerHTML = '';
                
                const response = await fetch(`${SCRIPT_URL}?action=LOAD&sheetId=${currentSheetId}`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    localStorage.setItem('workData', JSON.stringify(result.data));
                    syncAlert.textContent = '✅ Dati caricati con successo!';
                    syncAlert.className = 'alert alert-success';
                    syncAlert.classList.remove('hidden');
                } else {
                    syncAlert.textContent = 'ℹ️ Nessun dato trovato online. Aggiungi il primo giorno di lavoro!';
                    syncAlert.className = 'alert alert-info';
                    syncAlert.classList.remove('hidden');
                }
            } catch (error) {
                syncAlert.textContent = '❌ Errore nel caricamento: ' + error.message;
                syncAlert.className = 'alert alert-error';
                syncAlert.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
                loadUserData();
            }
        }

        function loadUserData() {
            const userData = JSON.parse(localStorage.getItem('workData')) || [];
            userData.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            workDaysList.innerHTML = '';
            
            let totalDaysCount = 0;
            let totalEarningsCount = 0;
            
            userData.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'work-day';
                
                const dateObj = new Date(day.date);
                const formattedDate = dateObj.toLocaleDateString('it-IT', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                dayElement.innerHTML = `
                    <button class="delete-btn" onclick="deleteWorkDay(${day.id})">Elimina</button>
                    <h3>${formattedDate}</h3>
                    <p><strong>Paga:</strong> €${day.pay.toFixed(2)}</p>
                    <p><strong>Note:</strong> ${day.notes || 'Nessuna nota'}</p>
                `;
                
                workDaysList.appendChild(dayElement);
                
                totalDaysCount++;
                totalEarningsCount += day.pay;
            });
            
            if (userData.length > 0) {
                totalSection.classList.remove('hidden');
                totalDays.textContent = totalDaysCount;
                totalEarnings.textContent = totalEarningsCount.toFixed(2);
            } else {
                totalSection.classList.add('hidden');
                workDaysList.innerHTML = '<p>Nessun giorno di lavoro registrato.</p>';
            }
        }

        function deleteWorkDay(workDayId) {
            const userData = JSON.parse(localStorage.getItem('workData')) || [];
            const updatedData = userData.filter(day => day.id !== workDayId);
            localStorage.setItem('workData', JSON.stringify(updatedData));
            loadUserData();
        }

        // Rendere le funzioni globali
        window.deleteWorkDay = deleteWorkDay;
        window.loadDataFromWeb = loadDataFromWeb;
    </script>
</body>

</html>


